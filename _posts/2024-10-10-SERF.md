---
layout: single
title:  "SeRF: Segment Graph for Range-Filtering Approximate Nearest Neighbor Search"
categories: VectorDB
tag: [database, algorithm]
toc: true
toc_sticky: true
author_profile: true
---

# SeRF: Segment Graph for Range-Filtering Approximate Nearest Neighbor Search
## About Paper
- 제목: SeRF: Segment Graph for Range-Filtering Approximate Nearest Neighbor Search
- 저널: ACM Manag. Data, Vol. 2, No. 1 (SIGMOD, Special Interest Group on Management of Data), Article 69. Feb 2024.
- 저자: Chaoji Zuo, Miao Qiao, Wenchao Zhou, FeiFei Li, Dong Deng

## Introduction
### ANN Search가 사용되는 분야
- image, document, graph와 같은 실세계 데이터를 고차원 벡터로 임베딩하는 기술이 계속해서 발전하는 중
- 한편, 이러한 데이터는 timestamps, prices, quantities와 같은 structured data와 함께 연관되어 사용되곤 했음
    - 예시 1: 상품 탐색
        - 200달러 미만의 주어진 이미지와 비슷한 상품 탐색
    - 예시 2: 자동차 탐색
        - 도로 위 카메라는 주어진 이미지를 임베딩하여 벡터 생성
        - 생성된 벡터는 database timestamp에 저장 및 탐색
        - 번호판 없이, (time, space, image) 정보로 차량 특정
- 그러나, 기존 RDBMS 기반 Filtering과 벡터 탐색을 동시에 수행하는 것은 여전히 데이터공학에서 도전적인 분야
    - 해당 문제 해결을 위한 다양한 질의 최적화 기법, 인덱싱 기법이 연구 중에 있음
    - 아직 많이 미흡한 상황..
    - ~~한번 떠올려보자. 이미지 검색과 동시에 다양한 필터링 조건을 붙여본 경험이 있던가?~~

### RFANNS(Range-Filtering Approximate Nearest Neighbor Search)
- 위 설명과 같이, 조건을 붙여 벡터를 탐색하는 기법을 RFANNS(Range-Filtering Approximate Nearest Neighbor Search)라 칭함
- Range-Filtering ANNS(Approximate Nearest Neighbor Search)는 query range(질의 범위)와 query vector(질의 벡터)로 구성됨
    - 도전적인 분야인 이유는 생각보다 단순하다.
    - 전체 벡터에 대한 인덱스는 존재하나, 필터링 된 벡터에 대한 인덱스는 없기 때문..
- 한편, 기존 range-filtering ANNS는 크게 2가지로 분류가 가능하다.
    - ANNS-first (vectorDB-first)
        - ANNS-first는 주어진 query range에 부합할 때까지 ANN Search 수행
        - 주어진 query range에 부합하는 vector들을 반환
        - query range가 작은 경우, 조건에 부합하는 vector를 지속적으로 탐색하므로 수행 속도가 느리다
    - range-first (RDBMS-first)
        - 주어진 range에 따른 structured database에서 우선 탐색
        - structured database에서 필터링된 레코드에 대한 vector index가 구축되어 있지 않아 filtering 된 vector들은 naive한 탐색을 수행
        - 특히, range-first는 query range가 클 때, 비효율적
    - 주어진 상황에 어떤 전략을 취해야 할지에 대한 연구는 아래 논문을 참고하자
        - Jianguo Wang, et al. "Milvus: A Purpose-Built Vector Data Management System". ACM SIGMOD '21.
        - [https://dl.acm.org/doi/10.1145/3448016.3457550](https://dl.acm.org/doi/10.1145/3448016.3457550)

### HNSW(Hierarchical Navigable Small World)
1. Paper
    - Yu. A. Malkov, D. A. Yashunin. “Efficient and robust approximate nearest neighbor search using Hierarchical Navigable Small World”. IEEE Transactions on pattern analysis and machine intelligence. 2018.
    - [http://arxiv.org/pdf/1603.09320](http://arxiv.org/pdf/1603.09320)

2. My Paper Review
    - [https://meongju0o0.github.io/vectordb/HNSW/](https://meongju0o0.github.io/vectordb/HNSW/)

### Proposing Solution: Segment Graph
- Half-bounded Range-Filtering ANNS Query: Segment Graph
    - Half-bounded: 주어진 set of vectors를 2개의 subset으로 분할
    - attribute에 따라 n개의 half-bounded hnsw index 생성 가능
    - 분할된 데이터를 통해 n개의 HNSW index 구축
    - 구축된 n개의 HNSW index를 무손실 압축하여 Segment Graph 구축
- General Range-Filtering ANNS Query: 2D Segment Graph
    - N개의 Segment Graph를 통해 2D Segment Graph 구축

## Preliminary

## RFANNS with Half-bounded Query Ranges

## RFANNS with Arbitrary Query Ranges

## Experiment

## Conclusion